# CVE-2021-44228

Use these query to look for CVE-2021-44228 Apache Log4j vulnerability. 

## Details

[Threat Alert: Apache Log4j RCE(CVE-2021-44228) aka Log4Shell](https://www.broadcom.com/support/security-center/protection-bulletin#blt3e71edabe2937935_en-us)

## EDR Prem Environment

### Query based on events 



#### Java launching exploit 

```
type_id:8001 and operation:1 and ( event_actor.file.name:java.exe or event_actor.file.name:javaw.exe ) and ( event_actor.cmd_line:"marshalsec.jndi.LDAPRefServer" and event_actor.cmd_line:"Exploit" )

```

#### Curl sending crafted strings to log4j

```
type_id:8001 and operation:1 and process.file.name:curl.exe and ( process.cmd_line:"jndi:ldap" or process.cmd_line:"jndi:rmi:" or process.cmd_line:"jndi:http:" or process.cmd_line:"jndi:dns:" or process.cmd_line:"lower:jndi" )

```

### Query on network-based protection

```
quick:"Vantage Detection" and (signature_id:33459 or signature_id:33460 or signature_id:33458 or signature_id:33455)

```

### Query on file-based protection

```
quick:"Antivirus Detection" and ( threat.name:CL.Suspexec!gen106 or threat.name:CL.Suspexec!gen107 or threat.name:CL.Suspexec!gen108 or threat.name:CL.Suspexec!sr109 )

```

### Query on behavior-based protection

```
quick:"SONAR Detection" and (bash.virus_name:SONAR.Maljava!g7 or bash.virus_name:SONAR.Susplaunch!g182 or bash.virus_name:SONAR.Susplaunch!g184 or bash.virus_name:SONAR.SuspLaunch!g186 or bash.virus_name:SONAR.Ransomware!g31 or bash.virus_name:SONAR.Ransomware!g32 or bash.virus_name:SONAR.SuspBeh!gen738)

```


### EDR CDM [Cloud Console queries]



### Query on behavior-based protection

#### Easy Filter

```
quick:Behavioral Analysis AND (Threat Name:SONAR.Maljava!g7 OR Threat Name:SONAR.Susplaunch!g182 OR Threat Name:SONAR.Susplaunch!g184 OR Threat Name:SONAR.SuspLaunch!g186 OR Threat Name:SONAR.Ransomware!g31 OR Threat Name:SONAR.Ransomware!g32 OR Threat Name:SONAR.SuspBeh!gen738) 

```

#### Advanced Filter

```
quick:"Behavioral Analysis" AND ( threat.name:"SONAR.Maljava!g7" OR threat.name:"SONAR.Susplaunch!g182" OR threat.name:"SONAR.Susplaunch!g184" OR threat.name:"SONAR.SuspLaunch!g186" OR threat.name:"SONAR.Ransomware!g31" OR threat.name:"SONAR.Ransomware!g32" OR threat.name:"SONAR.SuspBeh!gen738")

```


### Query on network-based protection

#### Easy Filter

```
( quick:Network Detection OR quick:Network Intrusion Prevention) AND ( Threat Id:33459 OR Threat Id:33460 OR Threat Id:33458 OR Threat Id:33455 )

```

#### Advanced Filter

```
(quick:"Network Detection" OR quick:"Network Intrusion Prevention") AND ( threat.id:33459 OR threat.id:33460 OR threat.id:33458 OR threat.id:33455 )

```

### Query on file-based protection

#### Easy Filter

```
quick:Malware Protection AND ( Threat Name:CL.Suspexec!gen106 OR Threat Name:CL.Suspexec!gen107 OR Threat Name:CL.Suspexec!gen108 OR Threat Name:CL.Suspexec!sr109 )

```

#### Advanced Filter

```
quick:"Malware Protection"  AND ( threat.name:"CL.Suspexec!gen106" OR threat.name:"CL.Suspexec!gen107" OR threat.name:"CL.Suspexec!gen108" OR threat.name:"CL.Suspexec!sr109" )

```

## Note
Kindly update and use latest AV definitions.
The clause used in query might be available in the latest version of the definitions only.
